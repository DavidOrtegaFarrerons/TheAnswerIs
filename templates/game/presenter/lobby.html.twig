{% extends 'base.html.twig' %}

{% block title %}Game Lobby{% endblock %}

{% block body %}
    <div class="min-h-screen bg-gray-50 flex flex-col items-center justify-center px-4">
        <div class="max-w-xl w-full bg-white rounded-2xl shadow-md p-8">
            <h1 class="text-2xl font-bold text-center text-gray-800 mb-6">Game Created</h1>
            <p class="text-gray-600 text-center mb-4">Share this link with your contestant:</p>

            <div class="space-y-6">
                <div>
                    <h2 class="text-md font-semibold text-gray-700 mb-2">ðŸŽ® Contestant Link</h2>
                    <div class="flex items-center gap-2">
                        <input type="text" readonly value="{{ publicUrl }}" id="contestantLink"
                               class="w-full bg-gray-100 text-sm px-4 py-2 rounded-lg border border-gray-300 cursor-pointer"
                               onclick="copyToClipboard('contestantLink')">
                        <button onclick="copyToClipboard('contestantLink')"
                                class="bg-blue-600 text-white px-3 py-2 rounded-lg text-sm hover:bg-blue-700 transition">
                            Copy
                        </button>
                    </div>
                </div>
            </div>

            <div class="mt-8 text-center">
                <p class="text-sm text-gray-500">Start when your contestant has joined.</p>
            </div>

            <div class="mt-6 text-center">
                <a id="start-button"
                   href="/game/presenter/start/{{ game.presenterToken }}"
                   class="hidden bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition">
                    Start Game
                </a>
            </div>
        </div>
    </div>

    <script>
        function copyToClipboard(id) {
            const input = document.getElementById(id);
            input.select();
            input.setSelectionRange(0, 99999);
            navigator.clipboard.writeText(input.value).then(() => {
                alert('Copied to clipboard');
            });
        }

        const eventSource = new EventSource('{{ mercure("/game/" ~ game.id) }}');

        eventSource.onmessage = (event) => {
            const data = JSON.parse(event.data);
            if (data.type === 'CONTESTANT_JOINED') {
                document.getElementById('start-button').classList.remove('hidden');
            }
        }
    </script>
{% endblock %}
