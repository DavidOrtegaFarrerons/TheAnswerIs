{% extends 'base.html.twig' %}

{% set routeName = constant('App\\Controller\\Game\\GameContestantController::GAME_CONTESTANT_LOBBY_ROUTE_NAME') %}
{% set publicUrl = absolute_url(path(routeName, { publicToken: game.publicToken })) %}
{% block title %}Game Lobby{% endblock %}

{% block body %}

    <div class="min-h-screen bg-gradient-to-br from-purple-700 via-indigo-700 to-blue-700 flex items-center justify-center p-6">
        <div class="w-full max-w-lg rounded-3xl bg-neutral-900/80 backdrop-blur-sm text-white px-10 py-14 space-y-10 shadow-2xl shadow-black/50">
            <div class="text-center space-y-4">
                <div class="text-6xl">ðŸŽ®</div>
                <h1 class="text-4xl font-extrabold tracking-tight">Sala de juego creada</h1>
                <p class="text-gray-300">Comparte este enlace con tu contrincante</p>
            </div>

            <div class="space-y-3">
                <h2 class="text-lg font-semibold">Enlace del jugador</h2>
                <div class="flex items-center gap-2">
                    <input id="contestantLink"
                           type="text"
                           readonly
                           value="{{ publicUrl }}"
                           class="w-full bg-neutral-800/60 text-gray-100 text-sm px-4 py-2 rounded-xl border border-white/20 cursor-pointer truncate"
                           onclick="copyToClipboard('contestantLink')">
                    <button type="button"
                            onclick="copyToClipboard('contestantLink')"
                            class="cursor-pointer shrink-0 rounded-full bg-yellow-500 px-4 py-2 text-sm font-semibold text-neutral-900 transition hover:bg-yellow-400">
                        Copiar
                    </button>
                </div>
            </div>

            <p class="text-center text-sm text-gray-400">Inicia la partida cuando tu contrincante se haya unido.</p>

            <div class="text-center hidden" id="start-container">
                <a id="start-button"
                   href="{{ path('game.presenter.start', { presenterToken: game.presenterToken }) }}"
                   class=" inline-flex items-center justify-center rounded-full bg-green-500 px-6 py-2 text-base font-semibold text-white transition hover:bg-green-400">
                    Comenzar
                </a>
            </div>
        </div>
    </div>

    <script>
        function copyToClipboard(id) {
            const input = document.getElementById(id);
            input.select();
            input.setSelectionRange(0, 99999);
            navigator.clipboard.writeText(input.value);
        }

        const es = new EventSource('{{ mercure("/game/" ~ game.id) }}');
        es.onmessage = e => {
            const data = JSON.parse(e.data);
            if (data.type === 'CONTESTANT_JOINED') {
                document.getElementById('start-container').classList.remove('hidden');
            }
        };
    </script>
{% endblock %}
