:80 {
  encode zstd gzip
  root * /var/www/html/public   # ← matches both containers

  # ─── Mercure passthrough ──────────────────────────────────────────────
  @mercure path /.well-known/mercure*           # match hub paths
  handle @mercure {
      reverse_proxy mercure:80                 # talk to the hub container
  }
  # ─── Everything else continues below ───────

  handle /hub* {
    reverse_proxy mercure:80 {
      header_up Authorization {>Authorization}
      header_up Cookie {>Cookie}
    }
  }

  # Static cache (optional)
  @static path *.css *.js *.mjs *.png *.jpg *.jpeg *.gif *.svg *.ico *.woff *.woff2 *.ttf *.eot
  handle @static {
    file_server
    header Cache-Control "public, max-age=31536000, immutable"
  }

  # Symfony front controller
  handle {
    try_files {path} {path}/ /index.php{uri}
    php_fastcgi php:9000
    file_server
  }

  log {
    output stdout
    format console
  }
}
